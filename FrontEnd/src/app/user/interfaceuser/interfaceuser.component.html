<!-- Main Dashboard Container -->
<main class="dashboard-container" role="main">
  <!-- Header Section -->
  <header class="dashboard-header" role="banner">
    <div class="user-info">
      <div class="user-avatar" role="img" aria-label="User avatar">
        <i class="fas fa-user-circle" aria-hidden="true"></i>
      </div>
      <div class="user-details">
        <h1>Xin ch√†o, {{username}}</h1>
      </div>
    </div>
    <div class="header-actions">
      <div class="notification-container">
        <button class="notification-btn" (click)="toggleNotifications()" [attr.aria-expanded]="showNotifications">
          <i class="fas fa-bell" aria-hidden="true"></i>
          <span class="notification-badge" *ngIf="unreadCount > 0" role="status">{{unreadCount}}</span>
        </button>
        <div class="notification-dropdown" *ngIf="showNotifications" role="dialog" aria-label="Notifications">
          <div class="notification-header">
            <h3>üìÖ Th√¥ng B√°o</h3>
            <button class="close-btn" (click)="closeNotifications()" aria-label="Close notifications">
              <i class="fas fa-times" aria-hidden="true"></i>
            </button>
          </div>
          <div class="notification-list">
            <div *ngIf="notifications.length === 0" class="no-notifications">
              B·∫°n ch∆∞a c√≥ th√¥ng b√°o n√†o
            </div>
            <div class="notification-messages" *ngIf="notifications.length > 0">
              <article class="notification-message" *ngFor="let appoi of notifications" [ngClass]="{'unread': appoi.isNew}">
                <div class="message-content">
                  <p>
                    L·ªãch h·∫πn c·ªßa th√∫ c∆∞ng <strong>{{ appoi.petName }}</strong> ng√†y <strong>{{ appoi.appointmentDate | date:'dd/MM/yyyy HH:mm' }}</strong>
                    <span class="status-badge" [ngClass]="{
                      'status-pending': appoi.status === 'PENDING',
                      'status-confirmed': appoi.status === 'CONFIRMED',
                      'status-done': appoi.status === 'COMPLETED'
                    }" role="status">{{ getStatusText(appoi.status) }}</span>
                    <span *ngIf="appoi.isNew" class="new-badge" role="status">M·ªõi</span>
                    <span *ngIf="!appoi.isNew" class="old-badge" role="status">C≈©</span>
                  </p>
                  <div class="message-details">
                    <span class="service-info">
                      <i class="fas fa-list" aria-hidden="true"></i> D·ªãch v·ª•:
                      <span *ngFor="let s of appoi.services; let last = last">
                        {{ s }}<span *ngIf="!last">, </span>
                      </span>
                    </span>
                    <span class="price-info">
                      <i class="fas fa-money-bill" aria-hidden="true"></i> T·ªïng ti·ªÅn: {{ getTotalPrice(appoi.services) | number }} VNƒê
                    </span>
                  </div>
                  <div class="message-actions">
                    <button class="read-btn" (click)="navigateToAppointmentDetails(appoi.id)" aria-label="View appointment details">
                      <i class="fas fa-eye" aria-hidden="true"></i> Xem chi ti·∫øt
                    </button>
                  </div>
                </div>
              </article>
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="dashboard-content">
    <!-- Quick Actions -->
    <section class="quick-actions" aria-labelledby="quick-actions-title">
      <h2 id="quick-actions-title">Thao t√°c nhanh</h2>
      <div class="action-cards">
        <button class="action-card" (click)="navigateTo('/addappointment')" aria-label="Book appointment">
          <i class="fas fa-calendar-alt" aria-hidden="true"></i>
          <h3>ƒê·∫∑t l·ªãch</h3>
          <p>ƒê·∫∑t l·ªãch kh√°m b·ªánh cho th√∫ c∆∞ng</p>
        </button>
        <button class="action-card" (click)="navigateTo('/allappointment')" aria-label="View history">
          <i class="fas fa-history" aria-hidden="true"></i>
          <h3>L·ªãch s·ª≠</h3>
          <p>Xem l·ªãch s·ª≠ kh√°m b·ªánh</p>
        </button>
        <button class="action-card" (click)="navigateTo('/listmypets')" aria-label="Manage pets">
          <i class="fas fa-paw" aria-hidden="true"></i>
          <h3>Th√∫ c∆∞ng</h3>
          <p>Qu·∫£n l√Ω th√¥ng tin th√∫ c∆∞ng</p>
        </button>
        <button class="action-card" (click)="navigateTo('/allproduct')" aria-label="Shop">
          <i class="fas fa-shopping-cart" aria-hidden="true"></i>
          <h3>Mua s·∫Øm</h3>
          <p>Mua s·∫£n ph·∫©m cho th√∫ c∆∞ng</p>
        </button>
      </div>
    </section>

    <!-- Dashboard Grid -->
    <div class="dashboard-grid">
      <!-- Upcoming Appointments -->
      <section class="dashboard-section" aria-labelledby="upcoming-appointments-title">
        <div class="section-header">
          <h2 id="upcoming-appointments-title">L·ªãch h·∫πn s·∫Øp t·ªõi</h2>
          <button class="view-all-btn" (click)="navigateTo('/allappointment')" aria-label="View all appointments">
            <i class="fas fa-arrow-right" aria-hidden="true"></i> Xem t·∫•t c·∫£
          </button>
        </div>
        <div class="appointments-grid" *ngIf="scheduledAppointments.length > 0">
          <article class="appointment-card" *ngFor="let appoi of scheduledAppointments">
            <div class="appointment-header">
              <div class="pet-info">
                <i class="fas fa-paw" aria-hidden="true"></i>
                <h3>{{ appoi.petName }}</h3>
              </div>
              <div class="owner-info">
                <i class="fas fa-user" aria-hidden="true"></i>
                <span>{{ appoi.petOwnerName }}</span>
              </div>
            </div>
            <div class="appointment-details">
              <div class="detail-item">
                <i class="fas fa-calendar-alt" aria-hidden="true"></i>
                <span>{{ appoi.appointmentDate | date:'dd/MM/yyyy HH:mm' }}</span>
              </div>
              <div class="detail-item">
                <i class="fas fa-list" aria-hidden="true"></i>
                <div class="services-list">
                  <span *ngFor="let s of appoi.services; let last = last">
                    {{ s }}<span *ngIf="!last">, </span>
                  </span>
                </div>
              </div>
              <div class="detail-item">
                <i class="fas fa-money-bill" aria-hidden="true"></i>
                <span>{{ getTotalPrice(appoi.services) | number }} VNƒê</span>
              </div>
            </div>
            <div class="appointment-actions">
              <button class="view-details-btn" (click)="navigateToAppointmentDetails(appoi.id)" aria-label="View appointment details">
                <i class="fas fa-eye" aria-hidden="true"></i> Xem chi ti·∫øt
              </button>
            </div>
          </article>
        </div>
        <div class="no-appointments" *ngIf="scheduledAppointments.length === 0">
          <i class="fas fa-calendar-times" aria-hidden="true"></i>
          <p>B·∫°n ch∆∞a c√≥ l·ªãch h·∫πn n√†o</p>
        </div>
      </section>

      <!-- Health Tips -->
      <section class="dashboard-section health-tips" aria-labelledby="health-tips-title">
        <div class="section-header">
          <h2 id="health-tips-title">L·ªùi khuy√™n s·ª©c kh·ªèe</h2>
        </div>
        <div class="tips-container">
          <article class="tip-card">
            <i class="fas fa-heartbeat" aria-hidden="true"></i>
            <h3>ChƒÉm s√≥c s·ª©c kh·ªèe</h3>
            <p>Ki·ªÉm tra s·ª©c kh·ªèe ƒë·ªãnh k·ª≥ cho th√∫ c∆∞ng c·ªßa b·∫°n</p>
          </article>
          <article class="tip-card">
            <i class="fas fa-utensils" aria-hidden="true"></i>
            <h3>Dinh d∆∞·ª°ng</h3>
            <p>Ch·∫ø ƒë·ªô ƒÉn u·ªëng c√¢n b·∫±ng v√† ph√π h·ª£p</p>
          </article>
          <article class="tip-card">
            <i class="fas fa-running" aria-hidden="true"></i>
            <h3>V·∫≠n ƒë·ªông</h3>
            <p>Duy tr√¨ ho·∫°t ƒë·ªông th·ªÉ ch·∫•t th∆∞·ªùng xuy√™n</p>
          </article>
        </div>
      </section>
    </div>

    <!-- Additional Sections -->
    <div class="dashboard-grid">
      <!-- Recent Activities -->
      <section class="dashboard-section" aria-labelledby="recent-activities-title">
        <div class="section-header">
          <h2 id="recent-activities-title">Ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y</h2>
        </div>
        <div class="activity-list">
          <article class="activity-item" *ngFor="let appoi of appointments.slice(0, 3)">
            <div class="activity-icon">
              <i class="fas fa-calendar-check" aria-hidden="true"></i>
            </div>
            <div class="activity-details">
              <h4>L·ªãch h·∫πn v·ªõi {{ appoi.petName }}</h4>
              <p>{{ appoi.appointmentDate | date:'dd/MM/yyyy HH:mm' }}</p>
              <span class="activity-date" role="status">{{ getStatusText(appoi.status) }}</span>
            </div>
          </article>
        </div>
      </section>

      <!-- Quick Links -->
      <section class="dashboard-section" aria-labelledby="quick-links-title">
        <div class="section-header">
          <h2 id="quick-links-title">Li√™n k·∫øt nhanh</h2>
        </div>
        <nav class="quick-links">
          <a href="/profile" class="quick-link" aria-label="Go to profile">
            <i class="fas fa-user" aria-hidden="true"></i>
            <span>H·ªì s∆° c√° nh√¢n</span>
          </a>
          <a href="/chat/chatrealtime" class="quick-link" aria-label="Chat with doctor">
            <i class="fas fa-comments" aria-hidden="true"></i>
            <span>Chat v·ªõi b√°c sƒ©</span>
          </a>
          <a href="/support" class="quick-link" aria-label="Get support">
            <i class="fas fa-headset" aria-hidden="true"></i>
            <span>H·ªó tr·ª£</span>
          </a>
        </nav>
      </section>
    </div>
  </div>
</main>
